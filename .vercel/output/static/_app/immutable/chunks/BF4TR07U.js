import{ah as y,a8 as w,ai as E,ab as A,aj as v}from"./2Hr-knV9.js";import{i as L,a as T,p as k,b as x}from"./BDVqeuoX.js";function D(t,o,c){y(()=>{var n=w(()=>o(t,c?.())||{});if(c&&n?.update){var a=!1,i={};E(()=>{var e=c();A(e),a&&v(i,e)&&(i=e,n.update(e))}),a=!0}if(n?.destroy)return()=>n.destroy()})}function F(t){const o=JSON.parse(t);return o.data&&(o.data=k(o.data,x.decoders)),o}function u(t){return HTMLElement.prototype.cloneNode.call(t)}function S(t,o=()=>{}){if(u(t).method!=="post")throw new Error('use:enhance can only be used on <form> fields with method="POST"');const c=async({action:a,result:i,reset:e=!0,invalidateAll:s=!0})=>{i.type==="success"&&(e&&HTMLFormElement.prototype.reset.call(t),s&&await L()),(location.origin+location.pathname===a.origin+a.pathname||i.type==="redirect"||i.type==="error")&&await T(i)};async function n(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:u(t).method)!=="post")return;a.preventDefault();const e=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:u(t).action),s=a.submitter?.hasAttribute("formenctype")?a.submitter.formEnctype:u(t).enctype,p=new FormData(t,a.submitter);if(s!=="multipart/form-data"){for(const r of p.values())if(r instanceof File)throw new Error('Your form contains <input type="file"> fields, but is missing the necessary `enctype="multipart/form-data"` attribute. This will lead to inconsistent behavior between enhanced and native forms. For more details, see https://github.com/sveltejs/kit/issues/9819.')}const d=new AbortController;let f=!1;const h=await o({action:e,cancel:()=>f=!0,controller:d,formData:p,formElement:t,submitter:a.submitter})??c;if(f)return;let l;try{const r=new Headers({accept:"application/json","x-sveltekit-action":"true"});s!=="multipart/form-data"&&r.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(s)?s:"application/x-www-form-urlencoded");const b=s==="multipart/form-data"?p:new URLSearchParams(p),m=await fetch(e,{method:"POST",headers:r,cache:"no-store",body:b,signal:d.signal});l=F(await m.text()),l.type==="error"&&(l.status=m.status)}catch(r){if(r?.name==="AbortError")return;l={type:"error",error:r}}await h({action:e,formData:p,formElement:t,update:r=>c({action:e,result:l,reset:r?.reset,invalidateAll:r?.invalidateAll}),result:l})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",n),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",n)}}}export{D as a,S as e};
